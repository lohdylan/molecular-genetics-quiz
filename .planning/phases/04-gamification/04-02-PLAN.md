---
phase: 04-gamification
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified: [web/index.html]
autonomous: true

must_haves:
  truths:
    - "User unlocks achievement badges for milestones"
    - "User sees toast notification when achievement unlocks"
    - "User can view achievements gallery showing earned and locked badges"
    - "Locked badges show requirements to unlock"
    - "Topic mastery badges unlock at 100% correct per topic"
  artifacts:
    - path: "web/index.html"
      provides: "Achievements system with badges, toasts, and gallery"
      contains: "achievementDefinitions"
  key_links:
    - from: "selectAnswer()"
      to: "checkAchievements()"
      via: "function call after answer"
      pattern: "checkAchievements\\("
    - from: "toast notification"
      to: "CSS animation"
      via: "toast-enter class"
      pattern: "toast.*animation"
---

<objective>
Build the achievements system with milestone badges, topic mastery badges, toast notifications, and a viewable gallery.

Purpose: Create meaningful goals and rewards that motivate continued study through visible progress milestones and topic expertise recognition.

Output: Updated web/index.html with achievement definitions, unlock detection, toast popups, and an achievements gallery screen.
</objective>

<execution_context>
@C:\Users\dylan\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\dylan\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-gamification/04-CONTEXT.md
@.planning/phases/04-gamification/04-01-SUMMARY.md

Key decisions from CONTEXT.md:
- Achievement types: Milestones + topic mastery badges
- Toast popup auto-dismisses after 3-4 seconds
- Dedicated achievements page showing all badges (earned and locked)
- Locked achievements show requirements ("Complete 50 questions")
</context>

<tasks>

<task type="auto">
  <name>Task 1: Define achievements and storage</name>
  <files>web/index.html</files>
  <action>
Add achievement definitions and state management:

1. Create achievementDefinitions array:
```javascript
const achievementDefinitions = [
  // Milestone achievements
  {
    id: 'first_quiz',
    name: 'First Steps',
    description: 'Complete your first quiz',
    icon: 'üéØ',
    type: 'milestone',
    requirement: 'Complete 1 quiz'
  },
  {
    id: 'questions_10',
    name: 'Getting Started',
    description: 'Answer 10 questions',
    icon: 'üìö',
    type: 'milestone',
    requirement: 'Answer 10 questions'
  },
  {
    id: 'questions_50',
    name: 'Dedicated Learner',
    description: 'Answer 50 questions',
    icon: 'üìñ',
    type: 'milestone',
    requirement: 'Answer 50 questions'
  },
  {
    id: 'questions_100',
    name: 'Century Club',
    description: 'Answer 100 questions',
    icon: 'üíØ',
    type: 'milestone',
    requirement: 'Answer 100 questions'
  },
  {
    id: 'perfect_score',
    name: 'Perfect Score',
    description: 'Get 100% on a full quiz',
    icon: '‚≠ê',
    type: 'milestone',
    requirement: 'Score 100% on a quiz'
  },
  {
    id: 'hot_streak_5',
    name: 'On Fire',
    description: '5 correct answers in a row',
    icon: 'üî•',
    type: 'milestone',
    requirement: '5 consecutive correct'
  },
  {
    id: 'hot_streak_10',
    name: 'Unstoppable',
    description: '10 correct answers in a row',
    icon: 'üí™',
    type: 'milestone',
    requirement: '10 consecutive correct'
  },
  {
    id: 'streak_3',
    name: 'Consistent',
    description: 'Maintain a 3-day study streak',
    icon: 'üìÖ',
    type: 'milestone',
    requirement: '3-day streak'
  },
  {
    id: 'streak_7',
    name: 'Week Warrior',
    description: 'Maintain a 7-day study streak',
    icon: 'üèÜ',
    type: 'milestone',
    requirement: '7-day streak'
  }
];
```

2. Add topic mastery achievements dynamically (generated from unique topics in questions):
```javascript
function generateTopicAchievements() {
  const topics = [...new Set(questions.map(q => q.topic))];
  return topics.map(topic => ({
    id: `master_${topic.toLowerCase().replace(/\s+/g, '_')}`,
    name: `${topic} Master`,
    description: `100% correct on ${topic} questions`,
    icon: 'üß¨',
    type: 'mastery',
    topic: topic,
    requirement: `Master ${topic}`
  }));
}

// Combine milestone and topic achievements
const allAchievements = [...achievementDefinitions, ...generateTopicAchievements()];
```

3. Add to gamificationState (extend existing object):
```javascript
// In gamificationState, add:
unlockedAchievements: [],      // array of achievement IDs
totalQuestionsAnswered: 0,     // lifetime count
quizzesCompleted: 0            // full quiz completions
```

4. Update saveGamificationState/loadGamificationState to include new fields
  </action>
  <verify>
Console check:
- `allAchievements.length` should be > 9 (9 milestones + topic badges)
- `allAchievements.find(a => a.type === 'mastery')` should return topic achievement
- gamificationState should have unlockedAchievements array
  </verify>
  <done>
Achievement definitions exist for milestones and topic mastery, state tracks unlocked achievements
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement achievement unlock detection and toast notifications</name>
  <files>web/index.html</files>
  <action>
Add achievement checking and toast notification system:

1. Add CSS for toast notifications:
```css
.toast-container {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1000;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.toast {
  background: white;
  border-radius: 12px;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
  padding: 16px 20px;
  display: flex;
  align-items: center;
  gap: 12px;
  min-width: 280px;
  max-width: 350px;
  animation: toast-enter 0.4s ease, toast-exit 0.3s ease 3.5s forwards;
  border-left: 4px solid #667eea;
}

.toast-icon {
  font-size: 32px;
}

.toast-content {
  flex: 1;
}

.toast-title {
  font-weight: 700;
  color: #1f2937;
  font-size: 14px;
  margin-bottom: 2px;
}

.toast-label {
  font-size: 11px;
  color: #667eea;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.toast-description {
  font-size: 12px;
  color: #6b7280;
}

@keyframes toast-enter {
  from {
    opacity: 0;
    transform: translateX(100px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes toast-exit {
  from {
    opacity: 1;
    transform: translateX(0);
  }
  to {
    opacity: 0;
    transform: translateX(100px);
  }
}

@media (max-width: 640px) {
  .toast-container {
    left: 10px;
    right: 10px;
    top: 10px;
  }

  .toast {
    min-width: unset;
    max-width: unset;
  }
}
```

2. Add toast container to HTML body (after container div):
```html
<div class="toast-container" id="toast-container"></div>
```

3. Add showAchievementToast() function:
```javascript
function showAchievementToast(achievement) {
  const container = document.getElementById('toast-container');
  const toast = document.createElement('div');
  toast.className = 'toast';
  toast.innerHTML = `
    <div class="toast-icon">${achievement.icon}</div>
    <div class="toast-content">
      <div class="toast-label">Achievement Unlocked!</div>
      <div class="toast-title">${achievement.name}</div>
      <div class="toast-description">${achievement.description}</div>
    </div>
  `;
  container.appendChild(toast);

  // Remove toast after animation completes (3.8s)
  setTimeout(() => {
    toast.remove();
  }, 3800);
}
```

4. Add checkAchievements() function:
```javascript
function checkAchievements() {
  const newUnlocks = [];

  allAchievements.forEach(achievement => {
    // Skip if already unlocked
    if (gamificationState.unlockedAchievements.includes(achievement.id)) {
      return;
    }

    let unlocked = false;

    switch (achievement.id) {
      case 'first_quiz':
        unlocked = gamificationState.quizzesCompleted >= 1;
        break;
      case 'questions_10':
        unlocked = gamificationState.totalQuestionsAnswered >= 10;
        break;
      case 'questions_50':
        unlocked = gamificationState.totalQuestionsAnswered >= 50;
        break;
      case 'questions_100':
        unlocked = gamificationState.totalQuestionsAnswered >= 100;
        break;
      case 'perfect_score':
        // Checked at quiz completion
        break;
      case 'hot_streak_5':
        unlocked = gamificationState.currentStreak >= 5;
        break;
      case 'hot_streak_10':
        unlocked = gamificationState.currentStreak >= 10;
        break;
      case 'streak_3':
        unlocked = gamificationState.dailyStreak >= 3;
        break;
      case 'streak_7':
        unlocked = gamificationState.dailyStreak >= 7;
        break;
      default:
        // Topic mastery achievements
        if (achievement.type === 'mastery') {
          unlocked = checkTopicMastery(achievement.topic);
        }
    }

    if (unlocked) {
      newUnlocks.push(achievement);
      gamificationState.unlockedAchievements.push(achievement.id);
    }
  });

  // Show toasts for new unlocks
  newUnlocks.forEach((achievement, index) => {
    // Stagger toasts slightly
    setTimeout(() => {
      showAchievementToast(achievement);
    }, index * 300);
  });

  if (newUnlocks.length > 0) {
    saveGamificationState();
  }
}

function checkTopicMastery(topic) {
  // Check if all questions in topic have been answered correctly
  const topicQuestions = questions.filter(q => q.topic === topic);
  if (topicQuestions.length === 0) return false;

  const allCorrect = topicQuestions.every(q => {
    const result = questionResults[q.id];
    return result && result.correct;
  });

  return allCorrect;
}
```

5. Add checkPerfectScore() for end of quiz:
```javascript
function checkPerfectScore(finalScore, totalQuestions) {
  if (finalScore === totalQuestions) {
    if (!gamificationState.unlockedAchievements.includes('perfect_score')) {
      const achievement = allAchievements.find(a => a.id === 'perfect_score');
      gamificationState.unlockedAchievements.push('perfect_score');
      showAchievementToast(achievement);
      saveGamificationState();
    }
  }
}
```

6. Integrate into existing flow:
- In selectAnswer(): call checkAchievements() after awardXP()
- In selectAnswer(): increment gamificationState.totalQuestionsAnswered
- In showFinalScore(): increment gamificationState.quizzesCompleted, call checkPerfectScore(), call checkAchievements()
  </action>
  <verify>
1. Answer 10 questions: should see "Getting Started" toast
2. Get 5 correct in a row: should see "On Fire" toast
3. Complete full quiz with 100%: should see "Perfect Score" toast
4. Toasts auto-dismiss after ~4 seconds
5. Reload page: unlocked achievements still in gamificationState
  </verify>
  <done>
Achievements unlock based on actions, toast notifications appear and auto-dismiss
  </done>
</task>

<task type="auto">
  <name>Task 3: Build achievements gallery screen</name>
  <files>web/index.html</files>
  <action>
Add an achievements gallery that users can view:

1. Add CSS for achievements screen:
```css
.achievements-screen {
  display: none;
}

.achievements-screen.show {
  display: block;
  animation: fadeIn 0.3s ease;
}

.achievements-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
}

.achievements-title {
  color: #667eea;
  font-size: 28px;
  font-weight: 700;
}

.back-btn {
  background: #f1f5f9;
  border: none;
  color: #64748b;
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.2s;
}

.back-btn:hover {
  background: #e2e8f0;
  color: #334155;
}

.achievements-section {
  margin-bottom: 32px;
}

.achievements-section-title {
  font-size: 16px;
  font-weight: 600;
  color: #64748b;
  margin-bottom: 16px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.achievements-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 16px;
}

.achievement-card {
  background: white;
  border: 2px solid #e2e8f0;
  border-radius: 12px;
  padding: 20px;
  text-align: center;
  transition: all 0.2s;
}

.achievement-card.unlocked {
  border-color: #667eea;
  background: linear-gradient(135deg, #f8fafc 0%, #eef2ff 100%);
}

.achievement-card.locked {
  opacity: 0.6;
}

.achievement-card-icon {
  font-size: 40px;
  margin-bottom: 12px;
}

.achievement-card.locked .achievement-card-icon {
  filter: grayscale(100%);
}

.achievement-card-name {
  font-weight: 700;
  color: #1f2937;
  font-size: 14px;
  margin-bottom: 6px;
}

.achievement-card-description {
  font-size: 12px;
  color: #6b7280;
  margin-bottom: 8px;
}

.achievement-card-requirement {
  font-size: 11px;
  color: #94a3b8;
  font-style: italic;
}

.achievement-card.unlocked .achievement-card-requirement {
  color: #22c55e;
}

.achievements-stats {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 24px;
  display: flex;
  justify-content: space-around;
  text-align: center;
}

.achievements-stat-value {
  font-size: 32px;
  font-weight: 700;
}

.achievements-stat-label {
  font-size: 12px;
  opacity: 0.8;
}

@media (max-width: 640px) {
  .achievements-grid {
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }

  .achievement-card {
    padding: 14px;
  }

  .achievement-card-icon {
    font-size: 32px;
  }

  .achievements-stats {
    flex-direction: column;
    gap: 16px;
  }
}
```

2. Add achievements screen HTML (inside container, after final-score div):
```html
<div id="achievements-screen" class="achievements-screen">
  <div class="achievements-header">
    <h2 class="achievements-title">Achievements</h2>
    <button class="back-btn" onclick="hideAchievements()">‚Üê Back to Quiz</button>
  </div>

  <div class="achievements-stats">
    <div>
      <div class="achievements-stat-value" id="achievements-unlocked-count">0</div>
      <div class="achievements-stat-label">Unlocked</div>
    </div>
    <div>
      <div class="achievements-stat-value" id="achievements-total-count">0</div>
      <div class="achievements-stat-label">Total</div>
    </div>
    <div>
      <div class="achievements-stat-value" id="achievements-percent">0%</div>
      <div class="achievements-stat-label">Complete</div>
    </div>
  </div>

  <div class="achievements-section">
    <div class="achievements-section-title">Milestones</div>
    <div class="achievements-grid" id="milestone-achievements"></div>
  </div>

  <div class="achievements-section">
    <div class="achievements-section-title">Topic Mastery</div>
    <div class="achievements-grid" id="mastery-achievements"></div>
  </div>
</div>
```

3. Add button to view achievements (in gamification-bar, or near it):
```html
<!-- Add to gamification-bar after streak-display -->
<button class="view-achievements-btn" onclick="showAchievements()" title="View Achievements">üèÖ</button>
```

Add CSS for button:
```css
.view-achievements-btn {
  background: none;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  padding: 6px 10px;
  font-size: 18px;
  cursor: pointer;
  transition: all 0.2s;
}

.view-achievements-btn:hover {
  background: #f1f5f9;
  border-color: #667eea;
}
```

4. Add JavaScript for achievements screen:
```javascript
function showAchievements() {
  document.getElementById('quiz-area').style.display = 'none';
  document.getElementById('final-score').classList.remove('show');
  document.getElementById('achievements-screen').classList.add('show');
  renderAchievements();
}

function hideAchievements() {
  document.getElementById('achievements-screen').classList.remove('show');
  document.getElementById('quiz-area').style.display = 'block';
}

function renderAchievements() {
  const milestoneContainer = document.getElementById('milestone-achievements');
  const masteryContainer = document.getElementById('mastery-achievements');

  const milestones = allAchievements.filter(a => a.type === 'milestone');
  const mastery = allAchievements.filter(a => a.type === 'mastery');

  milestoneContainer.innerHTML = milestones.map(a => renderAchievementCard(a)).join('');
  masteryContainer.innerHTML = mastery.map(a => renderAchievementCard(a)).join('');

  // Update stats
  const unlocked = gamificationState.unlockedAchievements.length;
  const total = allAchievements.length;
  document.getElementById('achievements-unlocked-count').textContent = unlocked;
  document.getElementById('achievements-total-count').textContent = total;
  document.getElementById('achievements-percent').textContent = Math.round((unlocked / total) * 100) + '%';
}

function renderAchievementCard(achievement) {
  const isUnlocked = gamificationState.unlockedAchievements.includes(achievement.id);
  return `
    <div class="achievement-card ${isUnlocked ? 'unlocked' : 'locked'}">
      <div class="achievement-card-icon">${achievement.icon}</div>
      <div class="achievement-card-name">${achievement.name}</div>
      <div class="achievement-card-description">${achievement.description}</div>
      <div class="achievement-card-requirement">
        ${isUnlocked ? '‚úì Unlocked' : achievement.requirement}
      </div>
    </div>
  `;
}
```
  </action>
  <verify>
1. Click üèÖ button: achievements screen appears
2. See milestones section with all milestone badges
3. See topic mastery section with topic-specific badges
4. Unlocked badges have colored border, locked are grayed
5. Locked badges show requirement text
6. Stats show X/Y unlocked and percentage
7. "Back to Quiz" returns to quiz
8. Mobile: grid adjusts to 2 columns
  </verify>
  <done>
Achievements gallery shows all badges (earned/locked) with requirements, accessible via button
  </done>
</task>

</tasks>

<verification>
1. Open web/index.html in browser
2. Click üèÖ to view achievements gallery - shows all badges
3. Start quiz, answer 10 questions correctly: "Getting Started" + "On Fire" toasts appear
4. Toasts auto-dismiss after ~4 seconds
5. Check achievements gallery: those badges now show as unlocked
6. Complete full quiz with perfect score: "First Steps" and "Perfect Score" toasts
7. Reload page: all unlocked achievements persist
8. Locked achievements display requirements clearly
9. Test mobile: achievements grid shows 2 columns, toasts position correctly
</verification>

<success_criteria>
- Milestone achievements unlock at correct thresholds
- Topic mastery achievements check per-topic performance
- Toast notifications appear and auto-dismiss
- Achievements gallery accessible and shows earned/locked status
- Locked badges display requirements
- All achievement state persists in localStorage
</success_criteria>

<output>
After completion, create `.planning/phases/04-gamification/04-02-SUMMARY.md`
</output>
