---
phase: 03-web-foundation
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - web/index.html
autonomous: false

must_haves:
  truths:
    - "User's progress saves to localStorage"
    - "User refreshes page and progress is restored"
    - "User can reset progress to start fresh"
    - "App looks good on mobile (responsive)"
    - "Feedback has smooth animations"
  artifacts:
    - path: "web/index.html"
      provides: "Enhanced quiz with persistence and polish"
      contains: "localStorage"
  key_links:
    - from: "quiz state"
      to: "localStorage"
      via: "setItem/getItem"
      pattern: "localStorage\\.(set|get)Item"
    - from: "feedback display"
      to: "CSS transitions"
      via: "class toggle"
      pattern: "classList\\.(add|toggle)"
---

<objective>
Add localStorage persistence so progress survives page refresh, plus responsive styling and animations for polished UX.

Purpose: Make quiz production-ready with data persistence and mobile support.
Output: Enhanced index.html with localStorage save/load and polished responsive UI.
</objective>

<execution_context>
@C:\Users\dylan\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\dylan\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-web-foundation/03-01-SUMMARY.md
@web/index.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add localStorage persistence</name>
  <files>web/index.html</files>
  <action>
Enhance the JavaScript in index.html to add data persistence:

**Data to persist (store as JSON in localStorage key "quizProgress"):**
- currentQuestionIndex (which question user is on)
- score (current correct count)
- questionsOrder (array of indices - to maintain shuffle order)
- questionResults (object mapping question id to {answered: bool, correct: bool})
- lastAttemptDate (for history tracking)

**Functions to add:**
- saveProgress(): JSON.stringify state and save to localStorage
- loadProgress(): parse from localStorage, restore state
- resetProgress(): clear localStorage and reset state
- Call saveProgress() after each answer
- Call loadProgress() on page load (before first question display)

**Quiz history tracking:**
- Store array of past attempts in "quizHistory" localStorage key
- Each entry: {date, score, total, percentage}
- On quiz completion, add entry to history
- Show "Recent History" section on final score screen (last 5 attempts)

**UI additions:**
- Add "Reset Progress" button (confirmation dialog before clearing)
- Add history display on final score screen
- Show "Continuing from question X" message if resuming

**Edge cases:**
- If localStorage is empty, start fresh quiz
- If localStorage has invalid data, clear and start fresh
- Handle case where questions.js has changed (different question count)
  </action>
  <verify>
1. Answer 5 questions, note the score
2. Refresh the page (F5)
3. Verify: same question displayed, score preserved
4. Complete quiz, check history shows attempt
5. Start new quiz, verify history still shows previous attempt
6. Click Reset Progress, verify all data cleared
  </verify>
  <done>
- Progress survives page refresh (question index, score, shuffle order)
- Quiz history tracks completed attempts
- Reset Progress clears all localStorage data
- Invalid/corrupted localStorage handled gracefully
  </done>
</task>

<task type="auto">
  <name>Task 2: Add responsive styling and animations</name>
  <files>web/index.html</files>
  <action>
Enhance CSS in index.html for polish:

**Responsive layout:**
- Mobile-first approach: default styles for mobile
- @media (min-width: 768px) for tablet/desktop
- Max-width container (800px) centered on large screens
- Padding adjustments for different screen sizes
- Answer buttons stack vertically on mobile, can be 2-column on desktop
- Font sizes scale appropriately

**Animations (CSS transitions):**
- Feedback slide-in: transform + opacity transition (0.3s ease)
- Answer button hover: subtle scale + shadow increase
- Correct answer: brief green glow/pulse
- Incorrect answer: brief red shake animation
- Progress bar fill: smooth width transition
- Score number count-up effect (optional, can use JS)

**Visual polish:**
- Improve button styling: rounded corners, consistent padding
- Add subtle card shadows (box-shadow)
- Typography: increase line-height for readability
- Color refinements: ensure sufficient contrast
- Focus states for accessibility (keyboard navigation)
- Disable answer buttons after selection (prevent double-click)

**CSS to add/modify:**
```css
/* Transitions */
.feedback {
  opacity: 0;
  transform: translateY(-10px);
  transition: opacity 0.3s, transform 0.3s;
}
.feedback.visible { opacity: 1; transform: translateY(0); }

/* Shake animation for wrong answer */
@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  75% { transform: translateX(5px); }
}
.shake { animation: shake 0.3s ease; }

/* Mobile-first responsive */
@media (min-width: 768px) {
  .container { max-width: 800px; padding: 2rem; }
  .options { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
}
```
  </action>
  <verify>
1. Open in browser, resize window to mobile width (~375px)
2. Verify: content readable, buttons full-width, no horizontal scroll
3. Resize to desktop width
4. Verify: content centered, max-width applied
5. Click answer: observe feedback animation
6. Click wrong answer: observe shake animation
7. Watch progress bar fill smoothly between questions
  </verify>
  <done>
- Quiz usable on mobile (responsive layout)
- Smooth animations on feedback, progress bar
- Polished button hover/active states
- No horizontal scroll on any screen size
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete web quiz with persistence and responsive styling</what-built>
  <how-to-verify>
1. Open web/index.html in browser
2. Take the quiz through a few questions:
   - Verify questions display correctly
   - Verify answer feedback is clear and animated
   - Verify progress bar updates smoothly
3. Refresh the page (F5):
   - Verify you resume from where you left off
   - Verify score is preserved
4. On mobile (or browser DevTools mobile view):
   - Verify layout is readable and usable
   - Verify buttons are easily tappable
5. Complete the quiz:
   - Verify final score shows correctly
   - Verify history shows your attempt
6. Click "Try Again":
   - Verify quiz resets with shuffled questions
  </how-to-verify>
  <resume-signal>Type "approved" to complete phase, or describe any issues to fix</resume-signal>
</task>

</tasks>

<verification>
Full manual testing checklist:
1. [ ] Quiz loads and displays first question
2. [ ] Answers are clickable, feedback shows
3. [ ] Progress bar advances correctly
4. [ ] Final score displays with correct percentage
5. [ ] Page refresh preserves progress
6. [ ] Reset Progress clears data
7. [ ] History tracks completed quizzes
8. [ ] Mobile layout is usable
9. [ ] Animations are smooth (feedback, progress bar)
</verification>

<success_criteria>
- [ ] localStorage saves: question index, score, shuffle order, history
- [ ] Page refresh restores exact quiz state
- [ ] Reset Progress works with confirmation
- [ ] Quiz history displays on final score screen
- [ ] Responsive: works on mobile and desktop
- [ ] Animations: feedback slide-in, progress bar smooth fill
- [ ] User verifies visual quality (checkpoint passed)
</success_criteria>

<output>
After completion, create `.planning/phases/03-web-foundation/03-02-SUMMARY.md`
</output>
